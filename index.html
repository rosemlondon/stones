<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pulling down the stones</title>
    <!-- Load three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Load 3d-force-graph -->
    <script src="https://unpkg.com/3d-force-graph"></script>
    <!-- Load three-spritetext -->
    <script src="https://unpkg.com/three-spritetext"></script>
    <link rel="stylesheet" type="text/css" href="3d-force-graph.css">
</head>
<body>
    <div id="3d-graph"></div>
    <button id="pause-btn">Pause</button>
    <button id="resume-btn">Resume</button>
    <div id="info-box">
        <div id="info-header"> Info</div>
        <div id="info-content">
          <p>Pulling down the stones is a walking journal and data visualisation experiment, mapping the landmarks of the Old Stones pilgrimage - a three-day walk through the main neolithic monuments across the peak district - onto a 3D force-directed node graph. Force-directed graph algorithms use physical simulation to position nodes in three-dimensional space, where the forces mimic attraction and repulsion to represent the strength and nature of their connections. This algorithm helps to visually organize and reveal the underlying structure of complex networks. </p>
        <p>This graph visualises data scraped from web forums and my journal after completing this walk in April 2024. The aim is to represent maps and walking differently. The work is built using the JavaScript library Three.js. Click on a node to see some stones. </p>
        </p>
        </div>
      </div>
      <script src="drag.js"></script>
      <script src="info.js"></script>
    <div id="image-container">
        <img id="node-image" src="" alt="Node Image">
    </div>
    <script>
        const Graph = ForceGraph3D()
            (document.getElementById('3d-graph'))
            .jsonUrl('test-dataset.json')
            .showNavInfo(false)
            .nodeThreeObject(node => {
                const sprite = new SpriteText(node.id);
                sprite.color = 'black';
                sprite.textHeight = 8;
                return sprite;
            })
            .linkLabel(link => link.id)
            .linkColor(() => 'black')
            .nodeColor(() => 'black')
            .backgroundColor('white')
            .onNodeClick(node => {
                console.log('clicked node:', node);

                const { nodes, links } = Graph.graphData();

                // Toggle the hidden status of the node
                node.__hidden = !node.__hidden;

                // Update the visibility of the links connected to this node
                links.forEach(link => {
                    if (link.source.id === node.id || link.target.id === node.id) {
                        link.__hidden = node.__hidden;
                    }
                });

                // Update the visibility of connected nodes
                nodes.forEach(n => {
                    const isConnected = links.some(link => 
                        (link.source.id === node.id && link.target.id === n.id) || 
                        (link.target.id === node.id && link.source.id === n.id)
                    );
                    if (isConnected) {
                        n.__hidden = node.__hidden;
                    }
                });

                console.log('Updated nodes:', nodes);
                console.log('Updated links:', links);

                Graph.refresh();

                // Display the node's image
                let imageCount = 0;

                if (imageCount >= 3) {
                    imageContainer.innerHTML = '';
                    imageCount = 0;
                }

                const imageContainer = document.getElementById('image-container');
                const nodeImage = document.getElementById('node-image');
                if (node.image) {
                    nodeImage.src = node.image;
                    imageContainer.style.display = 'block';
                    imageContainer.appendChild(nodeImage);
                } else {
                    imageContainer.style.display = 'none';
                }
            })
            .onNodeRightClick(node => {
                node.fx = node.fy = node.fz = null; // unfix node
            });

        // Auto-orbit
        let angle = 0;
        const distance = 300;
        let animationId;

        function animate() {
            animationId = requestAnimationFrame(animate);
            angle += 0.005;
            Graph.cameraPosition(
                { x: distance * Math.sin(angle), y: distance * Math.cos(angle), z: distance }
            );
        }

        animate(); // start animation

        document.getElementById('pause-btn').addEventListener('click', () => {
            cancelAnimationFrame(animationId);
        });

        document.getElementById('resume-btn').addEventListener('click', () => {
            animate();
        });


        
    </script>
    </div>

    <div id="typing-container"></div>
    <script src="typingscript.js"></script>
</body>
</html>
